<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Add Products</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg">
    <link href="assets/css/main.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />
</head>

<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="/admin/dashboard" class="brand-wrap">
                <img src="assets/imgs/theme/Logo2.png" class="logo" alt="LucidLayers">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i>
                </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/dashboard"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/products"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="page-orders-1.html"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/users"> <i class="icon material-icons md-person"></i>
                        <span class="text">users</span>
                    </a>
                </li>
                <li class="menu-item active">
                    <a class="menu-link" href="/admin/newproducts"> <i class="icon material-icons md-add_box"></i>
                        <span class="text">Add product</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/Categories"> <i
                            class="icon material-icons md-monetization_on"></i>
                        <span class="text">Categories</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-person"></i>
                        <span class="text">Account</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="page-reviews.html"> <i class="icon material-icons md-comment"></i>
                        <span class="text">Reviews</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="page-brands.html"> <i class="icon material-icons md-stars"></i>
                        <span class="text">Brands</span> </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" disabled href="#"> <i class="icon material-icons md-pie_chart"></i>
                        <span class="text">Statistics</span>
                    </a>
                </li>
            </ul>
            <hr>
            <br>
            <br>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
                <form class="searchform">
                    <div class="input-group">
                        <input list="search_terms" type="text" class="form-control" placeholder="Search term">
                        <button class="btn btn-light bg" type="button"> <i
                                class="material-icons md-search"></i></button>
                    </div>
                    <datalist id="search_terms">
                        <option value="Products">
                        <option value="New orders">
                        <option value="Apple iphone">
                        <option value="Ahmed Hassan">
                    </datalist>
                </form>
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i
                        class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link btn-icon" href="#">
                            <i class="material-icons md-notifications animation-shake"></i>
                            <span class="badge rounded-pill">3</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="requestfullscreen nav-link btn-icon"><i
                                class="material-icons md-cast"></i></a>
                    </li>
                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                            aria-expanded="false"> <img class="img-xs rounded-circle"
                                src="assets/imgs/people/avatar2.jpg" alt="User"></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                            <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit
                                Profile</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account
                                Settings</a>
                            <a class="dropdown-item" href="#"><i
                                    class="material-icons md-account_balance_wallet"></i>Wallet</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help
                                center</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="#"><i
                                    class="material-icons md-exit_to_app"></i>Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </header>
        <section class="content-main">
            <div class="row">
                <div class="col-9">
                    <div class="content-header">
                        <h2 class="content-title">Add New Product</h2>
                    </div>
                    <div class="messages">
                        <% if (messages.error && messages.error.length> 0) { %>
                            <div class="alert alert-danger">
                                <%= messages.error.join('<br>') %>
                            </div>
                            <% } %>

                                <% if (messages.success && messages.success.length> 0) { %>
                                    <div class="alert alert-success">
                                        <%= messages.success.join('<br>') %>
                                    </div>
                                    <% } %>
                    </div>

                    <form method="post" enctype="multipart/form-data">
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="mb-4">
                                    <label for="product_title" class="form-label">Product Title</label>
                                    <input type="text" placeholder="Type here" class="form-control" name="title"
                                        id="product_title">
                                </div>
                                <div class="row gx-3">
                                    <div class="col-md-4 mb-3">
                                        <label for="product_material" class="form-label">Material</label>
                                        <input type="text" placeholder="Type here" name="material" class="form-control"
                                            id="product_material">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="product_color" class="form-label">Color</label>
                                        <input type="text" placeholder="Type here" class="form-control" name="color"
                                            id="product_color">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="product_size" class="form-label">Size</label>
                                        <!-- <input type="text" placeholder="Type here" class="form-control" name="size" id="product_size"> -->
                                        <select class="form-select" name="size" id="product_size">
                                            <option value="" selected>Choose size</option>
                                            <option value="S">S</option>
                                            <option value="M">M</option>
                                            <option value="L">L</option>
                                            <option value="XL">XL</option>
                                        </select>
                                        
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label for="product_sleeve" class="form-label">Sleeve Length</label>
                                    <!-- <input type="text" placeholder="Type here" class="form-control" name="sleeve" id="product_sleeve"> -->
                                    <select class="form-select" name="sleeve" id="product_sleeve">
                                        <option value="" selected>Choose sleeveLength</option>
                                        <option value="Half">Half</option>
                                        <option value="Full">Full</option>
                                        < </select>
                                        
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <div class="card-body"> 
                                        <label for="gender" class="form-label">gender</label>
                                        <!-- <input type="text" placeholder="Type here" class="form-control" name="sleeve" id="product_sleeve"> -->
                                        <select class="form-select" name="gender" id="gender">
                                            <option value="" selected>Choose gender</option>
                                            <option value="male">male</option>
                                            <option value="female">female</option>
                                            <option value="unisex">Unisex</option>
                                            </select>
                                    </div>
                                </div>
                            </div> <!-- Card: Basic Info End -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div>
                                    <label class="form-label">Description</label>
                                    <textarea placeholder="Type here" class="form-control" name="description"
                                        rows="4"></textarea>
                                </div>
                            </div>
                        </div> <!-- Card: Description End -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="mb-4">
                                    <label for="product_price" class="form-label">Price</label>
                                    <input type="number" placeholder="Type here" class="form-control" name="price"
                                        id="product_price">
                                </div>
                                <div class="mb-4">
                                    <label for="product_stock" class="form-label">Stock</label>
                                    <input type="number" placeholder="Type here" class="form-control" name="stock"
                                        id="product_stock">
                                </div>
                            </div>
                        </div> <!-- Card: Price & Stock End -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="mb-4">
                                    <label for="product_category" class="form-label">Category</label>
                                    <select class="form-select" name="category" id="product_category">
                                        <option value="<%= data.category %>" selected>
                                            <%= data.category %>
                                        </option>
                                        <% if (data.length> 0) { %>
                                            <% data.forEach(function(category) { %>
                                                <option value="<%= category.name %>">
                                                    <%= category.name %>
                                                </option>
                                                <% }); %>
                                                    <% } %>
                                    </select>
                                </div>
                            </div>
                        </div> <!-- Card: Category End -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div>
                                    <label class="form-label">Images</label>
                                    <!-- Allow adding images one by one or multiple -->
                                    <input class="form-control" type="file" name="images" id="image" onchange="addSingleFile(event)" multiple>
                                    <div id="imagePreview" class="mt-3"></div>
                                </div>
                                <div id="cropModal" style="display: none">
                                    <img id="croppingImage" style="max-width: 100%" />
                                    <button type="button" id="cropButton" onclick="cropImage()">Crop Image</button>
                                </div>
                            </div>
                        </div>
                         <!-- Card: Images End -->
                        <div class="mb-4 text-center">
                            <button type="submit" class="btn btn-primary">Add Product</button>
                        </div>
                        <div class="mb-4 text-center">
                            <div id="message"></div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>
    <script src="assets/js/vendor.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
    let cropper;
let currentFile;
let currentImgElement;
let filesArray = []; // To keep track of all selected files

// Function to handle adding files one by one or multiple
function addSingleFile(event) {
    const fileInput = document.getElementById('image');
    const imagePreviewContainer = document.getElementById("imagePreview");
    const files = event.target.files; // Can handle multiple files

    Array.from(files).forEach(file => {
        filesArray.push(file); // Add each selected file to the array

        const reader = new FileReader();
        reader.onload = (e) => {
            currentFile = file;
            const imgContainer = document.createElement("div");
            imgContainer.style.display = "inline-block";
            imgContainer.style.position = "relative";
            imgContainer.style.marginRight = "10px";

            const img = document.createElement("img");
            img.src = e.target.result;
            img.style.width = "100px";
            img.style.cursor = "pointer";
            img.onclick = () => openCropper(e.target.result, img, filesArray.length - 1); // Cropping feature

            const removeButton = document.createElement("button");
            removeButton.textContent = "Remove";
            removeButton.style.position = "absolute";
            removeButton.style.top = "0";
            removeButton.style.right = "0";
            removeButton.style.backgroundColor = "red";
            removeButton.style.color = "white";
            removeButton.style.border = "none";
            removeButton.style.cursor = "pointer";
            removeButton.onclick = () => removeImage(filesArray.length - 1); // Remove image

            imgContainer.appendChild(img);
            imgContainer.appendChild(removeButton);
            imagePreviewContainer.appendChild(imgContainer);

            // Reset the input field to allow adding new files one by one
            fileInput.value = "";
        };

        reader.readAsDataURL(file);
    });
}

// Function to remove an image by index
function removeImage(index) {
    filesArray.splice(index, 1); // Remove the file from the array

    // Update the file input with the new files list
    const dataTransfer = new DataTransfer();
    filesArray.forEach((file) => dataTransfer.items.add(file));

    const fileInput = document.getElementById('image');
    fileInput.files = dataTransfer.files;

    // Re-render the image preview
    refreshImagePreview();
}

// Function to refresh image preview after an image is removed
function refreshImagePreview() {
    const imagePreviewContainer = document.getElementById("imagePreview");
    imagePreviewContainer.innerHTML = ""; // Clear the existing preview

    filesArray.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const imgContainer = document.createElement("div");
            imgContainer.style.display = "inline-block";
            imgContainer.style.position = "relative";
            imgContainer.style.marginRight = "10px";

            const img = document.createElement("img");
            img.src = e.target.result;
            img.style.width = "100px";
            img.style.cursor = "pointer";
            img.onclick = () => openCropper(e.target.result, img, index); // Handle cropping

            const removeButton = document.createElement("button");
            removeButton.textContent = "Remove";
            removeButton.style.position = "absolute";
            removeButton.style.top = "0";
            removeButton.style.right = "0";
            removeButton.style.backgroundColor = "red";
            removeButton.style.color = "white";
            removeButton.style.border = "none";
            removeButton.style.cursor = "pointer";
            removeButton.onclick = () => removeImage(index); // Remove by index

            imgContainer.appendChild(img);
            imgContainer.appendChild(removeButton);
            imagePreviewContainer.appendChild(imgContainer);
        };
        reader.readAsDataURL(file);
    });
}

// Function to open the cropper for a specific image
function openCropper(imageSrc, imgElement, index) {
    const cropModal = document.getElementById("cropModal");
    const croppingImage = document.getElementById("croppingImage");

    currentImgElement = imgElement; // Set the current image element
    croppingImage.src = imageSrc; // Set the source for cropping

    cropModal.style.display = "block"; // Show the crop modal
    if (cropper) cropper.destroy(); // Destroy previous instance

    cropper = new Cropper(croppingImage, {
        aspectRatio: 1,
        viewMode: 2,
    });
}

// Function to crop the image
function cropImage() {
    const canvas = cropper.getCroppedCanvas();

    canvas.toBlob((blob) => {
        const croppedFile = new File([blob], currentFile.name, { type: 'image/png' });

        // Replace the original file with the cropped one in the array
        const index = filesArray.indexOf(currentFile);
        if (index > -1) filesArray[index] = croppedFile;

        // Update the file input with the new files list
        const dataTransfer = new DataTransfer();
        filesArray.forEach((file) => dataTransfer.items.add(file));

        const fileInput = document.getElementById('image');
        fileInput.files = dataTransfer.files;

        // Update the preview with cropped image
        currentImgElement.src = URL.createObjectURL(croppedFile);

        // Hide the crop modal and destroy the cropper instance
        document.getElementById("cropModal").style.display = "none";
        cropper.destroy();
        cropper = null;
    }, 'image/png');
}
    
</script>
</body>

</html>