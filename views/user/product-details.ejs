<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>LucidLayers- Product Details</title>
    <link rel="shortcut icon" type="image/x-icon" href="/user/assets/images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.2/Toastify.min.css">
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header styles */
        .header {
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        .logo img {
            max-height: 40px;
        }
        .nav-menu {
            display: flex;
        }
        .nav-menu a {
            color: #333;
            text-decoration: none;
            padding: 10px 15px;
        }
        .header-icons a {
            color: #333;
            text-decoration: none;
            margin-left: 15px;
        }

        /* Product details styles */
        .product-details {
            display: flex;
            flex-wrap: wrap;
            padding: 40px 0;
        }
        .product-images {
            flex: 1;
            min-width: 300px;
        }
        .product-image-main {
            width: 100%;
            margin-bottom: 20px;
        }
        .product-image-main img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        .product-image-thumbnails {
            display: flex;
            gap: 10px;
        }
        .product-image-thumbnails img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
        }
        .product-info {
            flex: 1;
            min-width: 300px;
            padding-left: 40px;
        }
        .product-title {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .product-price {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .product-description {
            margin-bottom: 20px;
        }
        .product-sizes {
            margin-bottom: 20px;
        }
        .size-option {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .size-option.selected {
            background-color: #333;
            color: #fff;
        }
        .product-quantity {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .quantity-btn {
            background-color: #f0f0f0;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .quantity-input {
            width: 50px;
            text-align: center;
            margin: 0 10px;
        }
        .add-to-cart-btn {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
        }

        /* Related products styles */
        .related-products {
            padding: 40px 0;
            background-color: #f9f9f9;
        }
        .related-products h2 {
            text-align: center;
            margin-bottom: 30px;
        }
        .related-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .related-product-item {
            background-color: #fff;
            padding: 15px;
            text-align: center;
        }
        .related-product-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            margin-bottom: 10px;
        }

        /* Footer styles */
        .footer {
            background-color: #333;
            color: #fff;
            padding: 40px 0;
        }
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .footer-section {
            flex: 1;
            min-width: 200px;
            margin-bottom: 20px;
        }
        .footer-section h3 {
            margin-bottom: 15px;
        }
        .footer-section ul {
            list-style-type: none;
        }
        .footer-section ul li {
            margin-bottom: 10px;
        }
        .footer-section ul li a {
            color: #fff;
            text-decoration: none;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            .nav-menu {
                margin-top: 15px;
            }
            .product-details {
                flex-direction: column;
            }
            .product-info {
                padding-left: 0;
                margin-top: 20px;
            }
            .related-products-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="/user/home"><img src="/user/assets/images/logo/logo.png" alt="Toro Logo"></a>
                </div>
                <nav class="nav-menu">
                    <a href="/user/home">Home</a>
                    <a href="/user/shop">Shop</a>
                    <a href="#">Pages</a>
                    <a href="#">Blog</a>
                </nav>
                <div class="header-icons">
                    <a href="#"><i class="fas fa-search"></i></a>
                    <a href="/user/cart"><i class="fas fa-shopping-cart"></i></a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="product-details">
            <div class="container">
                <div class="product-images">
                    <div class="product-image-main">
                        <img src="/uploads/<%= data.images[0] %>" alt="<%= data.name %>" id="mainImage">
                    </div>
                    <div class="product-image-thumbnails">
                        <% data.images.forEach((image, index) => { %>
                            <img src="/uploads/<%= image %>" alt="<%= data.name %> thumbnail" onclick="changeMainImage(this.src)">
                        <% }); %>
                    </div>
                </div>
                <div class="product-info">
                    <h1 class="product-title"><%= data.name %></h1>
                    <div class="product-price">
                        ₹<%= data.lowestOfferPrice.toFixed(2) %>
                        <% if (data.lowestOfferPrice < data.originalPrice) { %>
                            <span style="text-decoration: line-through; color: #999; margin-left: 10px;">₹<%= data.originalPrice.toFixed(2) %></span>
                        <% } %>
                    </div>
                    <div class="product-description">
                        <p><%= data.description %></p>
                        <ul>
                            <li>Material: <%= data.material %></li>
                            <li>Sleeve: <%= data.sleeveLength %></li>
                        </ul>
                    </div>
                    <div class="product-sizes">
                        <h3>Size:</h3>
                        <% data.sizeVariations.forEach(variation => { %>
                            <span 
                                class="size-option <%= variation.stock === 0 ? 'disabled' : '' %>" 
                                data-price="<%= variation.price %>" 
                                data-stock="<%= variation.stock %>" 
                                onclick="selectSize(event, '<%= variation.size %>', <%= variation.price %>, <%= variation.stock %>)">
                                <%= variation.size %>
                            </span>
                        <% }); %>
                    </div>
                    <div class="product-quantity">
                        <button class="quantity-btn" onclick="decreaseQuantity()">-</button>
                        <input type="text" id="qtybutton" class="quantity-input" value="1" readonly>
                        <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                    </div>
                    <button class="add-to-cart-btn" id="addToCartButton">Add to Cart</button>
                </div>
            </div>
        </section>

        <section class="related-products">
            <div class="container">
                <h2>Related Products</h2>
                <div class="related-products-grid">
                    <% if (data.Related && data.Related.length > 0) { %>
                        <% for (const product of data.Related) { %>
                            <div class="related-product-item">
                                <a href="/user/product-details/<%= product._id %>">
                                    <img src="/uploads/<%= product.images[0] %>" alt="<%= product.name %>">
                                    <h3><%= product.name %></h3>
                                </a>
                            </div>
                        <% } %>
                    <% } else { %>
                        <p>No related products found.</p>
                    <% } %>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis nec vestibulum magna, et dapibus lacus.</p>
                </div>
                <div class="footer-section">
                    <h3>Useful Links</h3>
                    <ul>
                        <li><a href="/user/home">Home</a></li>
                        <li><a href="/user/shop">Shop</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Follow Us</h3>
                    <ul>
                        <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
                        <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
                        <li><a href="#"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Street, City, Country</li>
                        <li><i class="fas fa-phone"></i> +1 234 567 890</li>
                        <li><i class="fas fa-envelope"></i> info@example.com</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        let selectedSize = '';

        function changeMainImage(src) {
            document.getElementById('mainImage').src = src;
        }

        function decreaseQuantity() {
            const qtyInput = document.getElementById('qtybutton');
            let quantity = parseInt(qtyInput.value);
            if (quantity > 1) {
                qtyInput.value = quantity - 1;
            }
        }

        function increaseQuantity() {
            const qtyInput = document.getElementById('qtybutton');
            let quantity = parseInt(qtyInput.value);
            qtyInput.value = quantity + 1;
        }

        function selectSize(event, size, price, stock) {
            event.preventDefault();
            const sizeOptions = document.querySelectorAll('.size-option');
            sizeOptions.forEach(option => {
                option.classList.remove('selected');
            });

            const selectedOption = event.target;
            selectedOption.classList.add('selected');
            selectedSize = size;
        }

        async function addToCart(productId, quantity, selectedSize) {
            if (!selectedSize) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Please select a size.',
                    icon: 'error',
                    toast: true,
                    position: 'top',
                    showConfirmButton: false,
                    timer: 3000,
                });
                return;
            }

            try {
                const response = await fetch(`/user/add-to-cart/${productId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ quantity, selectedSize }),
                });

                const data = await response.json();

                if (response.ok) {
                    Swal.fire({
                        title: 'Success!',
                        text: data.message,
                        icon: 'success',
                        toast: true,
                        position: 'top',
                        showConfirmButton: false,
                        timer: 3000,
                    });
                } else {
                    Swal.fire({
                        title: 'Error!',
                        text: data.message,
                        icon: 'error',
                        toast: true,
                        position: 'top',
                        showConfirmButton: false,
                        timer: 3000,
                    });
                }
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({
                    title: 'Error!',
                    text: 'Error adding item to cart',
                    icon: 'error',
                    toast: true,
                    position: 'top',
                    showConfirmButton: false,
                    timer: 3000,
                });
            }
        }

        document.getElementById('addToCartButton').addEventListener('click', () => {
            const quantity = parseInt(document.getElementById('qtybutton').value);
            addToCart('<%= data._id %>', quantity, selectedSize);
        });
    </script>
</body>
</html>